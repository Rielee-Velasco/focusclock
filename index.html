<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GMT+8 Clock + YouTube Rain</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html, body {
      height: 100%; margin: 0; background: #000; color: orange;
      display: flex; align-items: center; justify-content: center;
      font-family: ui-monospace, monospace; user-select: none;
    }
    #clock { font-size: clamp(8rem, 20vw, 30rem); font-weight: 800; letter-spacing: .05em; text-align: center; }
    #sub, #hint, #toast {
      position: fixed; left: 0; right: 0; text-align: center;
      font-family: system-ui, sans-serif;
    }
    #sub  { bottom: 1rem; opacity:.65; font-size:1rem; }
    #hint { bottom: 2.6rem; opacity:.45; font-size:.95rem; }
    #toast { top:1rem; margin:0 1rem; padding:.45rem .6rem;
             background:rgba(255,165,0,.14); border:1px solid rgba(255,165,0,.4);
             color:orange; border-radius:.5rem; font-size:.9rem; display:none; }
    /* hide the YouTube iframe */
    #ytplayer { position:fixed; width:1px; height:1px; left:-9999px; top:-9999px; }
  </style>
</head>
<body>
  <div id="clock">00:00</div>
  <div id="hint">Tap/click once to enable fullscreen, keep-awake, and start YouTube rain • M = mute/unmute</div>
  <div id="sub">GMT+8 • 24-hour • YouTube rain</div>
  <div id="toast"></div>

  <!-- Hidden YouTube iframe -->
  <div id="ytplayer"></div>

  <script>
    // ---------- Clock ----------
    const fmt = new Intl.DateTimeFormat('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false, timeZone:'Asia/Manila' });
    const clock = document.getElementById('clock');
    function tick(){ clock.textContent = fmt.format(new Date()); }
    tick(); setInterval(tick, 1000);

    const hint=document.getElementById('hint'), toast=document.getElementById('toast');
    function showToast(msg,ms=1600){toast.textContent=msg;toast.style.display='block';clearTimeout(showToast._t);showToast._t=setTimeout(()=>toast.style.display='none',ms)}

    // ---------- Wake Lock + Fullscreen ----------
    let wakeLock=null;
    async function requestWakeLock(){try{if(!('wakeLock'in navigator))throw new Error('not supported');wakeLock=await navigator.wakeLock.request('screen');wakeLock.addEventListener('release',()=>wakeLock=null);}catch(e){showToast('Wake lock: '+e.message)}}
    async function goFullscreen(){try{if(!document.fullscreenElement)await document.documentElement.requestFullscreen();}catch(e){showToast('Fullscreen: '+e.message)}}
    document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible'&&!wakeLock)requestWakeLock();});

    // ---------- YouTube API ----------
    let player, muted=true;
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('ytplayer', {
        height: '1', width: '1',
        videoId: 'WPni755-Krg',
        playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': 'WPni755-Krg' },
        events: {
          'onReady': (e) => {
            // Start muted until unmuted manually
            e.target.mute();
            e.target.playVideo();
            showToast('Rain audio ready (muted)');
          }
        }
      });
    }
    // Load IFrame Player API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    // ---------- Activation ----------
    async function activate(){
      hint.style.display='none';
      await goFullscreen();
      await requestWakeLock();
      if (player) { player.playVideo(); }
      window.removeEventListener('pointerdown', activate);
      window.removeEventListener('keydown', activate);
    }
    window.addEventListener('pointerdown', activate, { once:true });
    window.addEventListener('keydown', activate, { once:true });

    // ---------- Controls ----------
    document.addEventListener('keydown', (e)=>{
      if (!player) return;
      const k=e.key.toLowerCase();
      if (k==='m'){
        if (muted){ player.unMute(); muted=false; showToast('Rain unmuted'); }
        else { player.mute(); muted=true; showToast('Muted'); }
      }
      if (k==='f') goFullscreen();
      if (k==='w') requestWakeLock();
    });
  </script>
</body>
</html>
